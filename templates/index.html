<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CYBER OPS · URL PHISHING ANALYZER</title>
  <style>
    :root{
      --bg:#071017;
      --panel:#0b1620;
      --muted:#9bb3c2;
      --accent:#00e6a8;
      --danger:#ff6b6b;
      --glass: rgba(255,255,255,0.03);
      --grid: rgba(255,255,255,0.02);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#041018 0%, #071622 100%);font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;color:var(--muted);-webkit-font-smoothing:antialiased}
    .container{max-width:1200px;margin:22px auto;padding:18px;display:grid;grid-template-columns:1fr 420px;gap:18px}
    .panel{background:linear-gradient(180deg,var(--panel), rgba(10,22,30,0.6));border-radius:10px;padding:14px;border:1px solid var(--grid);box-shadow:0 8px 30px rgba(0,0,0,0.6)}
    /* Left column: dashboard */
    .dashboard{display:grid;grid-template-rows:auto 1fr;gap:14px}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .logo{font-family:var(--mono);font-weight:700;color:var(--accent);letter-spacing:1px}
    .meta{font-size:13px;color:#7fa7b6}
    .input-row{display:flex;gap:10px;align-items:center;margin-top:6px}
    input[type="text"]{flex:1;padding:12px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--accent);font-family:var(--mono);outline:none}
    .btn{padding:10px 14px;border-radius:8px;border:none;background:linear-gradient(90deg,var(--accent),#00c78a);color:#04231a;font-weight:700;cursor:pointer;font-family:inherit}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .status-row{display:flex;gap:12px;margin-top:12px}
    .tile{flex:1;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);font-size:13px}
    .tile .label{font-size:12px;color:#7aa7b7}
    .tile .val{font-family:var(--mono);font-weight:700;color:var(--accent);margin-top:6px}
    /* main terminal */
    .terminal{background:#020609;border-radius:8px;padding:12px;height:400px;overflow:auto;border:1px solid rgba(0,0,0,0.6)}
    .term-line{font-family:var(--mono);font-size:13px;color:#8fe9c8;line-height:1.45}
    .term-line.muted{color:#6d8590}
    .term-line.warn{color:var(--danger)}
    /* right column: inspector */
    .inspector{display:flex;flex-direction:column;gap:12px}
    .inspector .card{padding:12px}
    .legend{display:flex;gap:8px;align-items:center;font-size:13px;color:#7fa7b6}
    .dot{width:10px;height:10px;border-radius:3px;display:inline-block}
    .dot.green{background:var(--accent)}
    .dot.red{background:var(--danger)}
    /* features table */
    .features{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:8px;border-radius:8px;max-height:260px;overflow:auto;border:1px solid rgba(255,255,255,0.03)}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:6px 8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.02);font-family:var(--mono)}
    th{color:#7ea9b8;font-weight:600;font-size:12px}
    /* result badge */
    .result-badge{padding:10px;border-radius:8px;font-weight:800;font-family:var(--mono);display:inline-block}
    .safe{background:rgba(0,200,120,0.08);color:var(--accent);border-left:4px solid rgba(0,200,120,0.18)}
    .phish{background:rgba(255,90,90,0.06);color:var(--danger);border-left:4px solid rgba(255,90,90,0.16)}
    /* small controls */
    .controls{display:flex;gap:8px;align-items:center}
    .small{font-size:12px;color:#6e8b97}
    footer{grid-column:1/-1;margin-top:14px;text-align:center;color:#6e91a0;font-size:12px}
    @media(max-width:980px){.container{grid-template-columns:1fr;padding:12px}.terminal{height:300px}}
  </style>
</head>
<body>
  <div class="container">
    <!-- LEFT: Dashboard -->
    <div class="panel dashboard">
      <div>
        <div class="topbar">
          <div>
            <div class="logo">CYBER · OPS</div>
            <div class="meta">URL Phishing Analyzer — Technical Console</div>
          </div>
          <div class="meta">Model: <code style="color:var(--accent);font-family:var(--mono)">{{ model.__class__.__name__ if model else 'model' }}</code></div>
        </div>

        <div class="input-row" style="margin-top:10px">
          <form id="scanForm" action="/predict" method="post" style="display:flex;width:100%;gap:8px">
            <input id="urlField" name="url" type="text" placeholder="Enter URL — e.g. https://login.example.com" autocomplete="off" />
            <button class="btn" type="submit">RUN</button>
            <button id="btnClear" type="button" class="btn ghost">CLEAR</button>
          </form>
        </div>

        <div class="status-row">
          <div class="tile">
            <div class="label">LAST SCAN</div>
            <div class="val" id="lastScan">{{ url or '—' }}</div>
          </div>
          <div class="tile">
            <div class="label">RESULT</div>
            <div class="val" id="lastResult">
              {% if prediction_text %}
                <span class="result-badge {% if 'Phishing' in prediction_text %}phish{% else %}safe{% endif %}">{{ prediction_text }}</span>
              {% else %}
                <span class="small muted">idle</span>
              {% endif %}
            </div>
          </div>
          <div class="tile">
            <div class="label">FEATURES</div>
            <div class="val">{{ feature_list|length if feature_list else '30' }}</div>
          </div>
        </div>
      </div>

      <div class="terminal panel" id="terminal">
        <div class="term-line muted">[SYS] Session started — Cyber OPS console ready</div>
        <div class="term-line">[I/O] Waiting for operator input...</div>
        {% if url %}
          <div class="term-line" style="margin-top:10px">[SCAN] Target: <strong style="color:var(--accent)">{{ url }}</strong></div>
          <div class="term-line">[ENGINE] Feature extraction: running <small class="small">30 features</small></div>
          <div class="term-line">[MODEL] Loaded: <code style="color:var(--accent);font-family:var(--mono)">{{ model.__class__.__name__ if model else 'model' }}</code></div>
          <div class="term-line" style="margin-top:8px">
            {% if 'Phishing' in prediction_text %}
              <span class="term-line warn">[ALERT] Phishing signature detected — immediate action recommended</span>
            {% else %}
              <span class="term-line">[OK] No obvious phishing markers detected</span>
            {% endif %}
          </div>
        {% endif %}
        <div id="logtail"></div>
      </div>
    </div>

    <!-- RIGHT: Inspector -->
    <div class="inspector">
      <div class="panel card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-family:var(--mono);font-weight:800;color:var(--accent)">INSPECTOR</div>
            <div class="small">Technical breakdown & feature inspector</div>
          </div>
          <div class="legend">
            <span class="dot green"></span><span>safe</span>
            <span style="width:10px"></span>
            <span class="dot red"></span><span>phish</span>
          </div>
        </div>

        <div style="margin-top:12px" class="small">Result details</div>
        <div style="margin-top:8px">
          {% if prediction_text %}
            <div class="small" style="margin-bottom:8px">Target: <code style="font-family:var(--mono)">{{ url }}</code></div>
            <div style="padding:8px;border-radius:6px;background:rgba(255,255,255,0.02);font-family:var(--mono)">{{ prediction_text }}</div>
          {% else %}
            <div class="small muted">No analysis yet — run a scan.</div>
          {% endif %}
        </div>
      </div>

      <div class="panel card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700">FEATURES</div>
          <div class="small">30 · runtime</div>
        </div>

        <div class="features" id="featuresBox" style="margin-top:8px">
          {% if features %}
            <table>
              <thead><tr><th>Feature</th><th>Value</th></tr></thead>
              <tbody>
                {% for f_val in features %}
                  <tr><td style="width:65%">{{ loop.index0 and feature_list[loop.index0] or feature_list[0] }}</td><td>{{ f_val }}</td></tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <div class="small muted">Feature vector not returned. Re-run with debugging enabled to display values.</div>
          {% endif %}
        </div>

        <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
          <button id="copyBtn" class="btn ghost" type="button">Copy report</button>
          <div class="small" id="copyStatus"></div>
        </div>
      </div>

      <div class="panel card">
        <div style="font-weight:700">ACTIONS</div>
        <div style="margin-top:8px" class="small">Quick operator actions</div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="recheck" class="btn ghost">Re-run</button>
          <button id="openTab" class="btn">Open Target</button>
        </div>
      </div>
    </div>

    <footer>Operational console • Keep scans lawful • Data sourced from live analysis</footer>
  </div>

  <script>
    // UI behaviors
    document.getElementById('btnClear').addEventListener('click', () => {
      document.getElementById('urlField').value = '';
      document.getElementById('lastScan').innerText = '—';
      document.getElementById('lastResult').innerHTML = '<span class="small muted">idle</span>';
      document.getElementById('featuresBox').innerHTML = '<div class="small muted">Feature vector not returned. Re-run with debugging enabled to display values.</div>';
    });

    // copy report
    document.getElementById('copyBtn').addEventListener('click', async () => {
      const url = document.getElementById('lastScan').innerText || '';
      const res = document.querySelector('#lastResult .result-badge') ? document.querySelector('#lastResult .result-badge').innerText : 'No result';
      const featuresEl = document.getElementById('featuresBox').innerText || '';
      const text = `Target: ${url}\nResult: ${res}\n\nFeatures:\n${featuresEl}`;
      try {
        await navigator.clipboard.writeText(text);
        document.getElementById('copyStatus').innerText = 'copied';
        setTimeout(()=>document.getElementById('copyStatus').innerText='',1200);
      } catch(e){
        document.getElementById('copyStatus').innerText = 'failed';
      }
    });

    // re-run opens the form submit again
    document.getElementById('recheck').addEventListener('click', () => {
      const url = document.getElementById('urlField').value;
      if (!url) return alert('Enter a URL first');
      document.getElementById('scanForm').submit();
    });

    // open target
    document.getElementById('openTab').addEventListener('click', () => {
      const url = document.getElementById('urlField').value || document.getElementById('lastScan').innerText;
      if (!url || url === '—') return alert('No target to open');
      window.open(url.startsWith('http') ? url : 'http://' + url, '_blank');
    });
  </script>
</body>
</html>
